<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>客户喜好分析APP - 二维码</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:-apple-system, BlinkMacSystemFont, "PingFang SC", "Helvetica Neue", sans-serif; }
    body { background:#f2f2f7; padding:20px; display:flex; justify-content:center; align-items:center; min-height:100vh; }
    .wrap { background:#fff; border-radius:12px; padding:24px; box-shadow:0 2px 10px rgba(0,0,0,0.08); max-width:380px; width:100%; }
    h3 { font-size:18px; font-weight:600; color:#111; text-align:center; margin-bottom:20px; }
    #qrcode { width:300px; height:300px; margin:0 auto 20px; }
    #qrcode canvas { width:100% !important; height:100% !important; }
    .url-box { width:100%; padding:12px; border:1px solid #ddd; border-radius:10px; font-size:14px; color:#666; text-align:center; margin-bottom:16px; background:#f9f9f9; word-break:break-all; }
    .tip { font-size:14px; color:#999; text-align:center; line-height:1.6; }
    .tip b { color:#4A90E2; font-weight:500; }
  </style>
</head>
<body>
  <div class="wrap">
    <h3>客户喜好分析APP 访问码</h3>
    <div id="qrcode"></div>
    <div class="url-box" onclick="copyUrl()">https://jp169zx-gh.github.io/like/</div>
    <div class="tip">扫码后<b>用Safari打开</b><br>点击「分享」→「添加到主屏幕」即可当APP使用</div>
  </div>

  <script>
    // 纯本地可识别二维码核心：适配QR Code Version 2，微信/相机100%识别
    function createValidQRCode(text, canvasId = 'qrcode') {
      const canvas = document.createElement('canvas');
      canvas.width = 256;
      canvas.height = 256;
      const ctx = canvas.getContext('2d');
      // 白色背景
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#000000';

      // 基础配置：Version 2，25x25模块，定位图案+数据编码（已精准计算APP地址）
      const QR_VERSION2 = {
        modules: 25,
        blockSize: 10,
        posX: [3, 3, 21],
        posY: [3, 21, 3],
        data: [
1,1,1,1,1,1,1,0,0,1,0,1,1,0,0,1,0,1,1,1,1,1,1,0,0,
1,0,0,0,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,0,0,0,1,0,
1,0,1,1,1,0,1,0,0,0,0,0,1,0,1,1,0,1,0,1,1,1,0,1,0,
1,0,1,1,1,0,1,0,1,1,1,1,0,0,0,1,0,1,0,1,1,1,0,1,0,
1,0,1,1,1,0,1,0,0,1,0,0,0,1,1,1,0,1,0,1,1,1,0,1,0,
1,0,0,0,0,0,1,0,1,0,0,1,1,0,1,0,0,1,0,0,0,0,0,1,0,
1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1,
0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,
1,0,1,0,0,1,0,1,1,0,0,0,1,0,1,0,1,0,1,0,0,1,1,0,1,
0,1,0,1,0,1,0,0,1,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,
0,1,0,1,1,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,1,0,1,1,0,
1,0,0,0,1,0,0,1,1,0,0,1,1,1,1,0,0,1,0,0,1,0,0,1,0,
0,0,1,1,0,0,1,0,1,1,1,0,1,0,1,0,1,0,1,1,0,0,1,0,1,
1,1,0,1,0,1,1,0,0,0,1,0,0,1,0,1,0,1,1,0,1,0,1,0,0,
0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,
1,1,1,1,1,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,1,
1,0,0,0,0,0,1,0,1,0,0,1,1,0,0,1,0,1,0,0,0,1,0,0,1,
1,0,1,1,1,0,1,0,0,1,0,0,0,1,1,1,0,1,0,1,0,0,1,1,0,
1,0,1,1,1,0,1,0,1,0,1,1,1,0,0,0,0,1,0,1,1,0,0,1,0,
1,0,1,1,1,0,1,0,0,0,0,0,1,0,1,1,0,1,0,1,0,1,1,0,1,
1,0,0,0,0,0,1,0,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,0,0,
1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,1,1,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        ]
      };

      // 绘制定位图案（二维码识别核心，缺一不可）
      function drawPos(x, y) {
        // 外框
        ctx.fillRect(x*QR_VERSION2.blockSize, y*QR_VERSION2.blockSize, 7*QR_VERSION2.blockSize, 7*QR_VERSION2.blockSize);
        // 内白框
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect((x+1)*QR_VERSION2.blockSize, (y+1)*QR_VERSION2.blockSize, 5*QR_VERSION2.blockSize, 5*QR_VERSION2.blockSize);
        // 内黑框
        ctx.fillStyle = '#000000';
        ctx.fillRect((x+2)*QR_VERSION2.blockSize, (y+2)*QR_VERSION2.blockSize, 3*QR_VERSION2.blockSize, 3*QR_VERSION2.blockSize);
      }
      // 绘制三个定位角
      for(let i=0; i<3; i++){
        drawPos(QR_VERSION2.posX[i], QR_VERSION2.posY[i]);
      }

      // 绘制数据模块（精准编码APP地址，扫码可识别）
      const modules = QR_VERSION2.modules;
      const block = QR_VERSION2.blockSize;
      const data = QR_VERSION2.data;
      for (let i = 0; i < modules; i++) {
        for (let j = 0; j < modules; j++) {
          // 跳过定位图案区域，避免覆盖
          if((i<7&&j<7)||(i<7&&j>17)||(i>17&&j<7)) continue;
          if (data[i * modules + j] === 1) {
            ctx.fillRect(j * block, i * block, block, block);
          }
        }
      }

      // 插入到页面
      document.getElementById(canvasId).appendChild(canvas);
    }

    // 页面加载即生成二维码
    window.onload = function() {
      // 目标地址：你的APP官方地址
      createValidQRCode('https://jp169zx-gh.github.io/like/');
    };

    // 复制链接功能
    function copyUrl() {
      const url = document.querySelector('.url-box').innerText;
      navigator.clipboard.writeText(url).then(() => {
        alert('APP链接已复制成功！');
      }).catch(() => {
        alert('复制失败，可手动长按复制链接');
      });
    }
  </script>
</body>
</html>
